# Пример конфигурационного файла
# Скопируйте этот файл в .env и заполните своими значениями

# ===== НАСТРОЙКИ ПРИЛОЖЕНИЯ =====
APP_NAME="Scalping Trading Bot"
APP_VERSION="1.0.0"
DEBUG=True
LOG_LEVEL=INFO

# ===== БЕЗОПАСНОСТЬ =====
# Секретный ключ для JWT токенов (сгенерируйте случайную строку)
# Используйте: openssl rand -hex 32
SECRET_KEY=VLTnCEHktMBFXqvj4adU7zDRSyGQlPAw

# Алгоритм шифрования JWT
ALGORITHM=HS256

# Время жизни токена доступа в минутах
ACCESS_TOKEN_EXPIRE_MINUTES=1440

# Пароль для входа в приложение (хешируется автоматически)
APP_PASSWORD=robocop89

# ===== НАСТРОЙКИ BYBIT API =====
# Режим работы: testnet или mainnet
BYBIT_MODE=mainnet

# API ключи для Bybit Testnet
BYBIT_API_KEY=9iAjXdXhFoa5ANtb0G
BYBIT_API_SECRET=H7unSmXrTcL1j7uAyeUWvCOs1nujJTNBfZGV

# API ключи для Bybit Mainnet (используются только если BYBIT_MODE=mainnet)
BYBIT_MAINNET_API_KEY=9iAjXdXhFoa5ANtb0G
BYBIT_MAINNET_API_SECRET=H7unSmXrTcL1j7uAyeUWvCOs1nujJTNBfZGV

# ===== ТОРГОВЫЕ НАСТРОЙКИ =====
# Торговые пары через запятую (без пробелов)
TRADING_PAIRS=BTCUSDT,ETHUSDT,SOLUSDT

# Максимальное количество пар на одно WebSocket соединение
MAX_PAIRS_PER_CONNECTION=10

# Глубина стакана (50, 200, 500)
ORDERBOOK_DEPTH=200

# ===== НАСТРОЙКИ СТРАТЕГИИ =====
# Порог дисбаланса для генерации сигнала на покупку (0.0-1.0)
IMBALANCE_BUY_THRESHOLD=0.75

# Порог дисбаланса для генерации сигнала на продажу (0.0-1.0)
IMBALANCE_SELL_THRESHOLD=0.25

# Минимальный объем для анализа кластера
MIN_CLUSTER_VOLUME=10000

# ===== НАСТРОЙКИ РИСК-МЕНЕДЖМЕНТА =====
# Максимальное количество открытых позиций одновременно
MAX_OPEN_POSITIONS=2

# Максимальная экспозиция в USDT
MAX_EXPOSURE_USDT=10000

# Минимальный размер ордера в USDT
MIN_ORDER_SIZE_USDT=5

# ===== НАСТРОЙКИ API СЕРВЕРА =====
# Хост и порт для FastAPI сервера
API_HOST=0.0.0.0
API_PORT=8000

# CORS разрешенные источники (через запятую)
CORS_ORIGINS=http://localhost:3000,http://localhost:5173

# ===== НАСТРОЙКИ WEBSOCKET =====
# Таймаут переподключения в секундах
WS_RECONNECT_TIMEOUT=5

# Максимальное количество попыток переподключения
WS_MAX_RECONNECT_ATTEMPTS=10

# Интервал ping-pong в секундах
WS_PING_INTERVAL=20

# ========================================
# DATABASE (PostgreSQL + TimescaleDB)
# ========================================
# Формат: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://trading_bot:robocop@localhost:5432/trading_bot

# Database pool настройки
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_ECHO=false

# ========================================
# REDIS (для будущего использования)
# ========================================
REDIS_URL=redis://localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# ========================================
# RATE LIMITING
# ========================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REST_PUBLIC=120
RATE_LIMIT_REST_PRIVATE=120
RATE_LIMIT_REST_TRADE=100
RATE_LIMIT_ORDER_PLACEMENT=50

# ========================================
# CIRCUIT BREAKER
# ========================================
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_COOLDOWN_SECONDS=60

# ========================================
# IDEMPOTENCY
# ========================================
IDEMPOTENCY_TTL_MINUTES=60

# ========================================
# RECOVERY & RECONCILIATION
# ========================================
AUTO_RECONCILE_ON_STARTUP=true
RECONCILE_INTERVAL_MINUTES=60

# ========================================
# ТОРГОВЫЕ НАСТРОЙКИ И РИСКИ
# ========================================

MAX_POSITION_SIZE_USDT=1000.0

IMBALANCE_THRESHOLD=0.7

# ========================================
# WEBSOCKET НАСТРОЙКИ
# ========================================

WS_RECONNECT_DELAY=5
# ==================== ML CONFIGURATION ====================
ML_SERVER_URL=http://localhost:8001
ML_MIN_CONFIDENCE=0.6
ML_WEIGHT=0.6
STRATEGY_WEIGHT=0.4

# ==================== STRATEGY CONFIGURATION ====================
# Режимы консенсуса: weighted, majority, unanimous
CONSENSUS_MODE=weighted
MIN_STRATEGIES=2
MIN_CONSENSUS_CONFIDENCE=0.6

# ==================== DETECTION CONFIGURATION ====================
SPOOFING_DETECTION_ENABLED=true
LAYERING_DETECTION_ENABLED=true
SR_DETECTION_ENABLED=true

# ==================== RECOVERY SERVICE ====================

# Таймаут для обнаружения зависших ордеров (в минутах)
# Ордер считается зависшим если находится в PENDING/PLACED дольше этого времени
HANGING_ORDER_TIMEOUT_MINUTES=30

# Автоматическое восстановление после краша
# true - выполнять recover_from_crash() при старте
ENABLE_AUTO_RECOVERY=true

# АВТОМАТИЧЕСКОЕ ИСПРАВЛЕНИЕ ЗАВИСШИХ ОРДЕРОВ =====
# true - автоматически исправлять зависшие ордера при обнаружении
# false - только логировать проблемы, не исправлять автоматически
AUTO_FIX_HANGING_ORDERS=true

# Проверка зависших ордеров при сверке
ENABLE_HANGING_ORDER_CHECK=true

# Автоматическое восстановление FSM при старте
ENABLE_FSM_AUTO_RESTORE=true

# Максимальное количество попыток сверки с биржей
MAX_RECONCILIATION_RETRIES=3

# Задержка между попытками сверки (секунды)
RECONCILIATION_RETRY_DELAY=2

# Детальное логирование зависших ордеров
DETAILED_HANGING_ORDER_LOGGING=true


# ==================== SCREENER SETTINGS ====================
# Настройки скринера торговых пар

# Bybit WebSocket URL для тикеров (публичный endpoint)
BYBIT_WS_URL=wss://stream.bybit.com/v5/public/linear

# Минимальный объем за 24ч для отображения в скринере (USDT)
SCREENER_MIN_VOLUME=4000000.0

# Максимальное количество пар в скринере
SCREENER_MAX_PAIRS=200

# Интервал broadcast данных скринера (секунды)
SCREENER_BROADCAST_INTERVAL=2.0

# Интервал очистки неактивных пар (секунды)
SCREENER_CLEANUP_INTERVAL=60

# TTL для неактивных пар (секунды)
SCREENER_INACTIVE_TTL=300

# Включение/отключение скринера
SCREENER_ENABLED=True

# Логирование статистики скринера (каждые N секунд)
SCREENER_STATS_LOG_INTERVAL=60

# ==================== DYNAMIC SYMBOLS SETTINGS ====================
# Динамическое управление списком торговых пар

# Включить динамическое управление (True/False)
DYNAMIC_SYMBOLS_ENABLED=True

# Минимальный объем за 24ч для фильтра (USDT)
DYNAMIC_MIN_VOLUME=4000000.0

# Максимум пар после фильтра по объему
DYNAMIC_MAX_VOLUME_PAIRS=200

# Количество растущих пар (топ по приросту)
DYNAMIC_TOP_GAINERS=25

# Количество падающих пар (топ по падению)
DYNAMIC_TOP_LOSERS=10

# Интервал обновления списка (секунды)
DYNAMIC_REFRESH_INTERVAL=180

# ==================== LEVERAGE CONFIGURATION ====================
DEFAULT_LEVERAGE=10
MAX_LEVERAGE=50

# Минимум 60 сек между сигналами
SIGNAL_COOLDOWN_SECONDS=60
# Запретить повторные BUY/SELL
ALLOW_SAME_DIRECTION_SIGNALS=false

# ============================================
# ЗАЩИТА ОТ СЛИВА ДЕПОЗИТА (разработка)
# ============================================

# Разрешить несколько позиций по одной паре (false = только 1 позиция на пару)
ALLOW_MULTIPLE_POSITIONS_PER_SYMBOL=false

# =============================================================================
# РАСШИРЕННЫЙ РИСК-МЕНЕДЖМЕНТ - НАСТРОЙКИ
# =============================================================================

# -----------------------------------------------------------------------------
# Unified SL/TP Calculator
# -----------------------------------------------------------------------------

# Метод расчета SL/TP: ml (ML-based), atr (ATR-based), fixed (фиксированный)
SLTP_CALCULATION_METHOD=ml

# Использовать ATR fallback при недоступности ML
SLTP_ML_FALLBACK_ENABLED=true

# Максимальный stop loss в процентах (default: 3%)
SLTP_MAX_STOP_LOSS_PERCENT=3.0

# Множитель ATR для stop loss (default: 2.0)
SLTP_ATR_MULTIPLIER_SL=2.0

# Множитель ATR для take profit (default: 4.0)
SLTP_ATR_MULTIPLIER_TP=4.0

# Минимальное соотношение риск/прибыль (default: 2.0)
SLTP_MIN_RISK_REWARD=4.0

# -----------------------------------------------------------------------------
# Correlation Manager - Управление коррелирующими позициями
# -----------------------------------------------------------------------------

# Проверять корреляцию между позициями
CORRELATION_CHECK_ENABLED=true

# Максимальная допустимая корреляция (0.0-1.0)
CORRELATION_MAX_THRESHOLD=0.7

# Максимум позиций в одной корреляционной группе
CORRELATION_MAX_POSITIONS_PER_GROUP=1

# Период расчета корреляции в днях
CORRELATION_LOOKBACK_DAYS=30

# -----------------------------------------------------------------------------
# Daily Loss Killer - Защита от больших дневных убытков
# -----------------------------------------------------------------------------

# Автоматическое отключение при дневном убытке
DAILY_LOSS_KILLER_ENABLED=true

# Максимальный дневной убыток для emergency shutdown (%)
DAILY_LOSS_MAX_PERCENT=15.0

# Процент убытка для предупреждения (%)
DAILY_LOSS_WARNING_PERCENT=10.0

# Интервал проверки дневного убытка (секунды)
DAILY_LOSS_CHECK_INTERVAL_SEC=60

# -----------------------------------------------------------------------------
# Adaptive Risk per Trade - Динамический риск на сделку
# -----------------------------------------------------------------------------

# Режим расчета риска: fixed (фиксированный), adaptive (адаптивный), kelly (Kelly Criterion)
RISK_PER_TRADE_MODE=adaptive

# Базовый риск на сделку в процентах от баланса
RISK_PER_TRADE_BASE_PERCENT=2.0

# Максимальный риск на сделку в процентах
RISK_PER_TRADE_MAX_PERCENT=5.0

# Kelly Criterion fraction (0.25 = 1/4 Kelly, консервативно)
RISK_KELLY_FRACTION=0.25

# Масштабировать риск на основе волатильности
RISK_VOLATILITY_SCALING=true
# Baseline дневной волатильности (2%)
RISK_VOLATILITY_BASELINE=0.02
# Масштабирование по win rate
RISK_WIN_RATE_SCALING=True
# Baseline win rate (55%)
RISK_WIN_RATE_BASELINE=0.55
# Штраф за корреляцию
RISK_CORRELATION_PENALTY=True

RISK_KELLY_MIN_TRADES=30


# -----------------------------------------------------------------------------
# Reversal Detector - Детектор разворота тренда
# -----------------------------------------------------------------------------

# Включить детектор разворота тренда
REVERSAL_DETECTOR_ENABLED=true

# Минимум индикаторов для подтверждения разворота
REVERSAL_MIN_INDICATORS_CONFIRM=3

# Cooldown между проверками разворота (секунды)
REVERSAL_COOLDOWN_SECONDS=300

# Автоматически действовать при обнаружении разворота
# false = только уведомление, true = автоматическое закрытие/корректировка
REVERSAL_AUTO_ACTION=false

# -----------------------------------------------------------------------------
# Trailing Stop Manager - Автоматический trailing stop
# -----------------------------------------------------------------------------

# Включить автоматический trailing stop
TRAILING_STOP_ENABLED=true

# При какой прибыли активировать trailing (%)
TRAILING_STOP_ACTIVATION_PROFIT_PERCENT=1.5

# Дистанция trailing stop от пика (%)
TRAILING_STOP_DISTANCE_PERCENT=0.8

# Интервал обновления trailing stop (секунды)
TRAILING_STOP_UPDATE_INTERVAL_SEC=5

# -----------------------------------------------------------------------------
# ML Integration для Риск-Менеджмента
# -----------------------------------------------------------------------------

# Использовать ML для корректировки риска
ML_RISK_INTEGRATION_ENABLED=true

# Минимальная уверенность ML для входа в позицию (0.0-1.0)
ML_MIN_CONFIDENCE_THRESHOLD=0.70

# Требовать согласия ML с сигналом стратегии
ML_REQUIRE_AGREEMENT=true

# ML корректировка размера позиции
ML_POSITION_SIZING=true

# ML расчет SL/TP уровней
ML_SLTP_CALCULATION=true

# ML проверка на манипуляции
ML_MANIPULATION_CHECK=true

# ML определение режима рынка
ML_REGIME_CHECK=true

# -----------------------------------------------------------------------------
# Notification Settings - Уведомления (Заглушки)
# -----------------------------------------------------------------------------

# Email уведомления (в разработке)
NOTIFICATION_EMAIL_ENABLED=false

# Telegram уведомления (в разработке)
NOTIFICATION_TELEGRAM_ENABLED=false

# =============================================================================
# РЕКОМЕНДУЕМЫЕ КОМБИНАЦИИ НАСТРОЕК
# =============================================================================

# === КОНСЕРВАТИВНЫЙ РЕЖИМ (Низкий риск) ===
# SLTP_MAX_STOP_LOSS_PERCENT=2.0
# SLTP_MIN_RISK_REWARD=2.5
# RISK_PER_TRADE_BASE_PERCENT=1.0
# RISK_PER_TRADE_MAX_PERCENT=2.0
# DAILY_LOSS_MAX_PERCENT=10.0
# CORRELATION_MAX_POSITIONS_PER_GROUP=1

# === СБАЛАНСИРОВАННЫЙ РЕЖИМ (Средний риск) ===
# SLTP_MAX_STOP_LOSS_PERCENT=3.0
# SLTP_MIN_RISK_REWARD=2.0
# RISK_PER_TRADE_BASE_PERCENT=2.0
# RISK_PER_TRADE_MAX_PERCENT=5.0
# DAILY_LOSS_MAX_PERCENT=15.0
# CORRELATION_MAX_POSITIONS_PER_GROUP=2

# === АГРЕССИВНЫЙ РЕЖИМ (Высокий риск) ===
# SLTP_MAX_STOP_LOSS_PERCENT=4.0
# SLTP_MIN_RISK_REWARD=1.5
# RISK_PER_TRADE_BASE_PERCENT=3.0
# RISK_PER_TRADE_MAX_PERCENT=7.0
# DAILY_LOSS_MAX_PERCENT=20.0
# CORRELATION_MAX_POSITIONS_PER_GROUP=3

# =============================================================================
# ВАЖНЫЕ ЗАМЕЧАНИЯ
# =============================================================================

# 1. SLTP_MAX_STOP_LOSS_PERCENT:
#    - Рекомендуется не превышать 3-4%
#    - Слишком широкие стопы = большие убытки
#    - Слишком узкие стопы = частые ложные срабатывания

# 2. SLTP_MIN_RISK_REWARD:
#    - Минимум 2.0 для прибыльной торговли
#    - 2.5-3.0 для консервативной стратегии
#    - Никогда не опускайте ниже 1.5

# 3. DAILY_LOSS_MAX_PERCENT:
#    - 15% - разумный максимум для защиты капитала
#    - При достижении лимита бот автоматически останавливается
#    - Счетчик сбрасывается в полночь UTC

# 4. CORRELATION_MAX_THRESHOLD:
#    - 0.7 - стандартное значение
#    - Выше 0.7 = высокая корреляция, опасно иметь много позиций
#    - Помогает диверсифицировать портфель

# 5. ML_MIN_CONFIDENCE_THRESHOLD:
#    - 0.70 = только высококачественные сигналы
#    - Ниже 0.60 = слишком много ложных сигналов
#    - Выше 0.80 = слишком мало сигналов

# 6. TRAILING_STOP:
#    - Активируется только при достижении TRAILING_STOP_ACTIVATION_PROFIT_PERCENT
#    - Защищает прибыль при продолжении движения
#    - TRAILING_STOP_DISTANCE_PERCENT = дистанция от пика

ENABLE_ADAPTIVE_CONSENSUS=true
PERFORMANCE_TRACKING_ENABLED=true
REGIME_DETECTION_ENABLED=true
WEIGHT_OPTIMIZATION_ENABLED=true
WEIGHT_OPTIMIZATION_METHOD=HYBRID
WEIGHT_UPDATE_FREQUENCY_SECONDS=21600

# === ADAPTIVE CONSENSUS ===

ADAPTIVE_MIN_SIGNALS_FOR_EVALUATION=20
ADAPTIVE_WEIGHT_UPDATE_FREQUENCY_SECONDS=21600

# === MULTI-TIMEFRAME ===
ENABLE_MTF_ANALYSIS=true
MTF_ACTIVE_TIMEFRAMES=1m,5m,15m,1h
MTF_PRIMARY_TIMEFRAME=1h
MTF_EXECUTION_TIMEFRAME=1m
MTF_SYNTHESIS_MODE=top_down
MTF_MIN_QUALITY=0.60
MTF_STAGGERED_UPDATE_INTERVAL=30

# === INTEGRATED ENGINE ===
INTEGRATED_ANALYSIS_MODE=hybrid
HYBRID_MTF_PRIORITY=0.6
HYBRID_MIN_AGREEMENT=true
HYBRID_CONFLICT_RESOLUTION=highest_quality
MIN_COMBINED_QUALITY=0.65

# === INTEGRATED ENGINE ===
MIN_SIGNAL_CONFIDENCE=0.60



# === ML COMPONENTS ===
ENABLE_ML_VALIDATION=true
ENABLE_ML_DATA_COLLECTION=true

# === DETECTORS ===
ENABLE_SPOOFING_DETECTION=true
ENABLE_LAYERING_DETECTION=true
ENABLE_DRIFT_DETECTION=true

# === PERFORMANCE ===
ANALYSIS_INTERVAL=0.5
ANALYSIS_WARNING_THRESHOLD=2.0
MAX_CONSECUTIVE_ERRORS=5
MIN_CANDLES_FOR_ANALYSIS=50

# Candle Configuration
CANDLE_LIMIT=200
CANDLE_UPDATE_INTERVAL=5

# === LOGGING ===
VERBOSE_SIGNAL_LOGGING=true
ENABLE_CRITICAL_ALERTS=true
ENABLE_DRIFT_ALERTS=true