# ๐ Layering ML - Quick Start

## ๐ ะงัะพ ััะพ ะทะฐ ัะธััะตะผะฐ?

**Layering ML** - ััะพ ะฐะฒัะพะผะฐัะธัะตัะบะฐั ัะธััะตะผะฐ ะพะฑะฝะฐััะถะตะฝะธั ััะฝะพัะฝัั ะผะฐะฝะธะฟัะปััะธะน ัะตัะตะท ะผะฐัะธะฝะฝะพะต ะพะฑััะตะฝะธะต.

### ๐ฏ ะัะฝะพะฒะฝะฐั ะธะดะตั

```
ะะฐะฝะธะฟัะปััะธั "Layering" (ะกะฟััะธะฝะณ):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. ะขัะตะนะดะตั ัะฐะทะผะตัะฐะตั ะะะะะซะ ะพัะดะตัะฐ (100 BTC bid)           โ
โ    โ                                                         โ
โ 2. ะกะพะทะดะฐะตััั ะธะปะปัะทะธั ัะฟัะพัะฐ                                 โ
โ    โ                                                         โ
โ 3. ะฆะตะฝะฐ ะะะกะขะะข ะธะท-ะทะฐ ะฟัะธัะพะปะพะณะธะธ                             โ
โ    โ                                                         โ
โ 4. ะขัะตะนะดะตั ะะะะะะะข ะฝะฐ ask (2 BTC)                           โ
โ    โ                                                         โ
โ 5. ะะขะะะะฏะะข ะฒัะต ะปะพะถะฝัะต bid ะพัะดะตัะฐ                           โ
โ    โ                                                         โ
โ 6. ะะะะคะะข! ะฆะตะฝะฐ ะฟะฐะดะฐะตั ะฝะฐะทะฐะด                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฐัะฐ ัะธััะตะผะฐ ะะะะะะฃะะะะะะข ััะพ ะฐะฒัะพะผะฐัะธัะตัะบะธ!**

---

## ๐๏ธ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั (3 ะบะพะผะฟะพะฝะตะฝัะฐ)

### 1๏ธโฃ LayeringDetector (ะะฑะฝะฐััะถะตะฝะธะต)
```
ะะฝะฐะปะธะทะธััะตั orderbook ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:
- ะะฐัะพะดะธั ัะปะพะธ ะพัะดะตัะพะฒ (3+ ะพัะดะตัะฐ ะฝะฐ ะฑะปะธะทะบะธั ัะตะฝะฐั)
- ะัะพะฒะตััะตั timing (ัะฐะทะผะตัะตะฝั ะทะฐ < 30 ัะตะบ?)
- ะะฝะฐะปะธะทะธััะตั execution ะฝะฐ ะฟัะพัะธะฒะพะฟะพะปะพะถะฝะพะน ััะพัะพะฝะต
- ะัะพะฒะตััะตั cancellation rate (> 50%?)
- ะััะธัะปัะตั confidence: 0.65+ = ะะะะะะะะขะะะฌะะ

ะะตะทัะปััะฐั: "๐จ Layering detected! BTCUSDT, confidence=0.78"
```

### 2๏ธโฃ LayeringDataCollector (ะกะฑะพั ะดะฐะฝะฝัั)
```
ะะฒัะพะผะฐัะธัะตัะบะธ ัะพััะฐะฝัะตั ะบะฐะถะดัะน ะพะฑะฝะฐััะถะตะฝะฝัะน ะฟะฐััะตัะฝ:
- 24 features (ะพะฑัะตะผ, timing, cancellation rate, etc.)
- Market context (volatility, liquidity, regime)
- Labels (true positive / false positive)

ะกะพััะฐะฝะตะฝะธะต ะบะฐะถะดัะต 100 ะฟะฐััะตัะฝะพะฒ ะฒ:
data/ml_training/layering/layering_data_20251115_120000.parquet
```

### 3๏ธโฃ AdaptiveLayeringModel (ะะฑััะตะฝะธะต)
```
ะะฑััะฐะตััั ะฝะฐ ัะพะฑัะฐะฝะฝัั ะดะฐะฝะฝัั:
- Algorithm: Random Forest (100 trees)
- Input: 24 features
- Output: True Positive vs False Positive
- Metrics: Accuracy 85%+, Precision 84%+

ะะตะทัะปััะฐั: ะะพะดะตะปั ัะปัััะฐะตั detection, ัะผะตะฝััะฐะตั false positives!
```

---

## ๐ ะะพะปะฝัะน ัะธะบะป ัะฐะฑะพัั

```mermaid
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    LAYERING ML WORKFLOW                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. ะะะะฃะกะ ะะะขะ
   โโ> python backend/main.py
       โโ> LayeringDetector ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ โ
       โโ> LayeringDataCollector ะธะฝะธัะธะฐะปะธะทะธัะพะฒะฐะฝ โ
       โโ> AdaptiveLayeringModel ะถะดะตั ะพะฑััะตะฝะธั...

2. ะะะะะขะ ะ ะะะะะฌะะะ ะะะะะะะ (ะฐะฒัะพะผะฐัะธัะตัะบะธ!)
   โโ> Detector ะฐะฝะฐะปะธะทะธััะตั orderbook ะบะฐะถะดัะน ัะธะบะป
       โโ> ะะฑะฝะฐััะถะตะฝ ะฟะฐััะตัะฝ! confidence=0.78
           โโ> DataCollector ัะพััะฐะฝัะตั ะฒ buffer
               โโ> Buffer = 100 samples
                   โโ> ะะะขะะกะะฅะะะะะะะ ะฒ Parquet โ

3. ะะะะะะะะะะ ะะะะะซะฅ (1-7 ะดะฝะตะน)
   โโ> 100 samples  โ 1 ัะฐะนะป
   โโ> 500 samples  โ 5 ัะฐะนะปะพะฒ
   โโ> 1000 samples โ 10 ัะฐะนะปะพะฒ

4. LABELING (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั supervised learning)
   โโ> Automatic: ะฟะพ price action validation
   โโ> Manual: ัะตัะตะท API ะธะปะธ ัะบัะธะฟั

5. ะะะฃะงะะะะ ะะะะะะ (ะบะพะณะดะฐ >= 100 labeled samples)
   โโ> python backend/scripts/train_layering_model.py
       โโ> Training...
       โโ> Accuracy: 87.6% โ
       โโ> Saved: data/models/layering_adaptive_v1.pkl โ

6. PRODUCTION (ะผะพะดะตะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะถะฐะตััั)
   โโ> python backend/main.py
       โโ> AdaptiveLayeringModel loaded โ
       โโ> Detector confidence: 0.78
       โโ> ML confidence: 0.85
       โโ> Final confidence: 0.815 (ML-adjusted) โ
       โโ> ะะตะฝััะต FALSE POSITIVES! โ
```

---

## ๐ฌ ะัััััะน ััะฐัั (5 ะผะธะฝัั)

### ะจะฐะณ 1: ะัะพะฒะตัััะต ัะตะบััะธะน ััะฐััั
```bash
python check_layering_data_status.py
```

**ะะตะทัะปััะฐั:**
```
๐ DIRECTORY STATUS
โ Directory does not exist yet  โ ะะพัะผะฐะปัะฝะพ, ะตัะต ะฝะต ะทะฐะฟััะบะฐะปัั
```

### ะจะฐะณ 2: ะะฐะฟัััะธัะต ะฑะพัะฐ ะดะปั ัะฑะพัะฐ ะดะฐะฝะฝัั
```bash
# ะ backend/.env ัััะฐะฝะพะฒะธัะต:
TRADING_MODE=ONLY_TRAINING  # ะะตะทะพะฟะฐัะฝะพ, ะฑะตะท ัะพัะณะพะฒะปะธ!

# ะะฐะฟัััะธัะต:
python backend/main.py
```

**ะงัะพ ะฟัะพะธะทะพะนะดะตั:**
```
[INFO] โ LayeringDataCollector ะฐะบัะธะฒะตะฝ (ONLY_TRAINING mode)
[INFO] ๐ Layering detected: BTCUSDT | confidence=0.78
[INFO] ๐ Layering ML data collected: BTCUSDT_1731668400000_0
...
[INFO] ๐พ Saved 100 samples to layering_data_20251115_120000.parquet
```

### ะจะฐะณ 3: ะะพะดะพะถะดะธัะต 1-7 ะดะฝะตะน
```bash
# ะะพะฝะธัะพัะธะฝะณ ะฟัะพะณัะตััะฐ:
python check_layering_data_status.py

# ะะตะทัะปััะฐั:
๐ STATISTICS
Total collected:     273
โณ Collecting data... (273/1000 recommended)
```

### ะจะฐะณ 4: ะะฑััะธัะต ะผะพะดะตะปั (ะบะพะณะดะฐ >= 100 labeled)
```bash
# ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ (ะตัะปะธ ะตัะต ะฝะตั):
pip install pandas pyarrow scikit-learn

# ะะฑััะธัะต:
python backend/scripts/train_layering_model.py
```

### ะจะฐะณ 5: ะัะฟะพะปัะทัะนัะต ะพะฑััะตะฝะฝัั ะผะพะดะตะปั
```bash
# ะะตัะตะบะปััะธัะตัั ะฒ FULL ัะตะถะธะผ:
# backend/.env
TRADING_MODE=FULL

# ะะฐะฟัััะธัะต:
python backend/main.py

# ะะตะทัะปััะฐั:
[INFO] โ AdaptiveLayeringModel initialized: trained=True
[INFO] ๐ฏ Using ML-adjusted confidence: 0.85 (was 0.78)
```

---

## ๐ ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ
```bash
# ะััััะฐั ะฟัะพะฒะตัะบะฐ (ะฑะตะท ะทะฐะฒะธัะธะผะพััะตะน)
python check_layering_data_status.py

# ะะตัะฐะปัะฝัะน ะฐะฝะฐะปะธะท (ััะตะฑัะตั pandas)
python analyze_layering_ml_data.py
```

### ะะพะฝะธัะพัะธะฝะณ ะปะพะณะพะฒ
```bash
# ะัะต ัะพะฑััะธั layering
tail -f logs/bot.log | grep -i layering

# ะขะพะปัะบะพ detection ัะพะฑััะธั
tail -f logs/bot.log | grep "Layering detected"

# ะขะพะปัะบะพ ัะพััะฐะฝะตะฝะธั ะดะฐะฝะฝัั
tail -f logs/bot.log | grep "Saved.*samples"
```

### ะัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ
```bash
# ะกะบะพะปัะบะพ ัะฐะนะปะพะฒ ัะพะฑัะฐะฝะพ?
ls -lh data/ml_training/layering/*.parquet

# ะะฑัะธะน ัะฐะทะผะตั
du -sh data/ml_training/layering/

# ะะพัะปะตะดะฝะธะต 5 ัะฐะนะปะพะฒ
ls -lt data/ml_training/layering/*.parquet | head -5
```

### API ะทะฐะฟัะพัั
```bash
# ะกัะฐัะธััะธะบะฐ collector
curl -X GET "http://localhost:8000/api/ml/data-collector/statistics"

# ะกัะฐััั ML ะผะพะดะตะปะธ
curl -X GET "http://localhost:8000/api/ml/adaptive-model/status"

# ะะตััะธะบะธ ะผะพะดะตะปะธ
curl -X GET "http://localhost:8000/api/ml/adaptive-model/metrics"
```

---

## โ FAQ

### Q: ะกะบะพะปัะบะพ ะฒัะตะผะตะฝะธ ะฝัะถะฝะพ ะดะปั ัะฑะพัะฐ ะดะฐะฝะฝัั?
**A:** ะะฐะฒะธัะธั ะพั ััะฝะพัะฝะพะน ะฐะบัะธะฒะฝะพััะธ:
- ะััะพะบะฐั ะฐะบัะธะฒะฝะพััั: 100 samples ะทะฐ 1-2 ะดะฝั
- ะกัะตะดะฝัั ะฐะบัะธะฒะฝะพััั: 100 samples ะทะฐ 3-5 ะดะฝะตะน
- ะะธะทะบะฐั ะฐะบัะธะฒะฝะพััั: 100 samples ะทะฐ 7+ ะดะฝะตะน

### Q: ะะฑัะทะฐัะตะปัะฝะพ ะปะธ labeling ะดะปั ะพะฑััะตะฝะธั?
**A:** ะะฐ, ะดะปั supervised learning ะฝัะถะฝั labels (True/False).
ะะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั:
- Automatic labeling (ะฟะพ price action)
- Manual labeling (ะฒัััะฝัั)
- Semi-supervised (mix)

### Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ะฑะตะท ะพะฑััะตะฝะธั ะผะพะดะตะปะธ?
**A:** ะะฐ! LayeringDetector ัะฐะฑะพัะฐะตั ะธ ะะะ ML ะผะพะดะตะปะธ.
ML ะผะพะดะตะปั ัะพะปัะบะพ ะฃะะฃะงะจะะะข accuracy ะธ ัะฝะธะถะฐะตั false positives.

### Q: ะะฐะบ ัะฐััะพ ะฟะตัะตะพะฑััะฐัั ะผะพะดะตะปั?
**A:** ะะตะบะพะผะตะฝะดัะตััั:
- ะะตัะฒะพะต ะพะฑััะตะฝะธะต: ะบะพะณะดะฐ >= 100 labeled samples
- ะะตัะตะพะฑััะตะฝะธะต: ัะฐะท ะฒ ะฝะตะดะตะปั/ะผะตััั (continuous learning)
- ะัะธ ะธะทะผะตะฝะตะฝะธะธ ััะฝะพัะฝัั ััะปะพะฒะธะน

### Q: ะะตะทะพะฟะฐัะฝะพ ะปะธ ะทะฐะฟััะบะฐัั ะฒ ONLY_TRAINING?
**A:** ะะฑัะพะปััะฝะพ! ะ ัะตะถะธะผะต ONLY_TRAINING:
- โ ะะพั ะะ ัะพัะณัะตั
- โ ะขะพะปัะบะพ ะฐะฝะฐะปะธะทะธััะตั ััะฝะพะบ
- โ ะกะพะฑะธัะฐะตั ะดะฐะฝะฝัะต ะฒ ัะพะฝะต
- โ ะะธะบะฐะบะธั ัะธัะบะพะฒ

### Q: ะกะบะพะปัะบะพ ะผะตััะฐ ะทะฐะฝะธะผะฐัั ะดะฐะฝะฝัะต?
**A:** Parquet ะพัะตะฝั ัััะตะบัะธะฒะตะฝ:
- 100 samples โ 50-100 KB
- 1000 samples โ 500 KB - 1 MB
- 10,000 samples โ 5-10 MB

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

- **ะะพะดัะพะฑะฝะพะต ััะบะพะฒะพะดััะฒะพ:** `cat LAYERING_ML_GUIDE.md` (15 KB)
- **ะฃััะฐะฝะพะฒะบะฐ ัะธััะตะผั:** `cat ML_DETECTION_SETUP.md`
- **ะััะพะดะฝัะน ะบะพะด ะดะตัะตะบัะพัะฐ:** `backend/ml_engine/detection/layering_detector.py`
- **ะััะพะดะฝัะน ะบะพะด ะบะพะปะปะตะบัะพัะฐ:** `backend/ml_engine/detection/layering_data_collector.py`
- **ะััะพะดะฝัะน ะบะพะด ะผะพะดะตะปะธ:** `backend/ml_engine/detection/adaptive_layering_model.py`
- **ะกะบัะธะฟั ะพะฑััะตะฝะธั:** `backend/scripts/train_layering_model.py`

---

## ๐ฏ ะัะพะณะพะฒะฐั ัะตะบะพะผะตะฝะดะฐัะธั

### ะัะปะธ ะฒั ะะะะะงะะ:
```bash
1. python check_layering_data_status.py          # ะัะพะฒะตัะธัั ััะฐััั
2. TRADING_MODE=ONLY_TRAINING                    # ะะตะทะพะฟะฐัะฝัะน ัะตะถะธะผ
3. python backend/main.py                        # ะะฐะฟัััะธัั ัะฑะพั
4. ะะพะดะพะถะดะฐัั 1-7 ะดะฝะตะน                            # ะะฐะบะพะฟะธัั ะดะฐะฝะฝัะต
5. python backend/scripts/train_layering_model.py # ะะฑััะธัั ะผะพะดะตะปั
```

### ะัะปะธ ะฒั ะฃะะ ะกะะะะะะ ะดะฐะฝะฝัะต:
```bash
1. python analyze_layering_ml_data.py            # ะะฝะฐะปะธะท ะดะฐะฝะฝัั
2. ะะตะฐะปะธะทะพะฒะฐัั labeling (ะตัะปะธ unlabeled)
3. python backend/scripts/train_layering_model.py # ะะฑััะธัั
4. TRADING_MODE=FULL                             # Production
5. python backend/main.py                        # ะัะฟะพะปัะทะพะฒะฐัั ML
```

### ะัะปะธ ะฒั ะะะะคะ:
```bash
1. ะะฐัััะพะธัั automatic labeling ะฒ detector
2. ะะฐะฟัััะธัั ะฒ FULL ัะตะถะธะผะต ััะฐะทั
3. Continuous learning ัะตัะตะท cron
4. ะะพะฝะธัะพัะธะฝะณ ะผะตััะธะบ ัะตัะตะท API
5. A/B ัะตััะธัะพะฒะฐะฝะธะต ัะฐะทะฝัั ะผะพะดะตะปะตะน
```

---

**ะฃะดะฐัะธ ั Layering ML! ๐**

ะะตััะธั: 1.0
ะะฐัะฐ: 2025-11-15
